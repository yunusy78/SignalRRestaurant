@model dynamic

@{
    ViewBag.Title = "title";
	Layout = "~/Areas/Admin/Views/AdminLayout/Index.cshtml";
}


<div class="main-panel">
<div class="content">
	<div class="container-fluid">
		<script type="text/javascript">
          $(document).ready(function () {
         var connection = new signalR.HubConnectionBuilder()
         .withUrl('@ViewBag.HubUrl')
         .build();
          $("#constatus").text(connection.state);
                                    
          connection.start().then(function () {
           $("#constatus").text(connection.state);
           setInterval(function(){
           connection.invoke("SendProgress");
		   connection.invoke("GetTotalCategoryCount");
            },1000);
            console.log("connected");
            }).catch(function (err) {
            return console.error(err.toString());
            });
		  
		   connection.on("ReceiveTotalActiveBookingCount",(result)=>{
           $("#activeBookingCount").text(result);
		   });	
		   
        	connection.on("ReceiveTotalCashRevenue",(result)=>{
            $("#totalCashRevenue").text("NOK " + result);
            });
			
        	connection.on("ReceiveTotalActiveTableCount",(result)=>{
            $("#totalActiveTableCount").text(result);
            });
			connection.on("ReceiveTotalPassiveTableCount",(result)=>{
            $("#totalPassiveTableCount").text(result);
            });

			connection.on("ReceiveTotalCategoryCount",(result)=>{
            $("#categoryCount").text(result); 
            }); 
            connection.on("ReceiveTotalProductCount",(result1)=>{
            $("#productcount").text(result1); 
            });	
			connection.on("ReceiveAveragePrice",(result)=>{
            $("#AveragePrice").text("NOK " + result); 
            });
      
             connection.on("ReceiveTotalCashRevenue",(result)=>{
             $("#TotalCashRevenue").text("NOK " + result);
             });
			                         
            // Progress bar'ı güncelle
 			connection.on("ReceiveTotalProductCount", function (result) {
             $("#progressBarProduct").css("width", result + "%").attr("aria-valuenow", result).attr("title",result).text(result);
             })
           
             connection.on("ReceiveTotalCategoryCount", function (result) {
             $("#progressBarCategory").css("width", result + "%").attr("aria-valuenow", result).attr("title",result).text(result);
             })  
             
             connection.on("ReceiveTotalActiveTableCount", function (result) {
             $("#progressBarActiveTableCount").css("width", result + "%").attr("aria-valuenow", result).attr("title",result).text(result);
             })
             
             connection.on("ReceiveTotalCashRevenue", function (result) {
             $("#progressBarCashRevenue").css("width", result + "%").attr("aria-valuenow", result).attr("title",result).text(result);
             })
           
             connection.on("ReceiveAveragePrice", function (result) {
             $("#progressBarAveragePrice").css("width", result + "%").attr("aria-valuenow", result).attr("title",result).text(result);
             })
                                   							 
			
            });
        </script>
		<h4 class="page-title">Øyeblikkelig Statistikk</h4>
		<div class="row row-card-no-pd">
			<div class="col-md-4">
				<div class="card">
					<div class="card-body">
						<p class="fw-bold mt-1">Min Saldo </p>
						<h4 id="totalCashRevenue"><b></b></h4>
						<a href="/Order/CreateOrder" class="btn btn-primary btn-full text-left mt-3 mb-3"><i class="la la-plus"></i> Ny Bestilling</a>
					</div>
					<div class="card-footer">
						<ul class="nav">
							<li class="nav-item"><a class="btn btn-default btn-link" href="#"><i class="la la-history"></i> History</a></li>
							<li class="nav-item ml-auto"><a class="btn btn-default btn-link" href="#"><i class="la la-refresh"></i> Refresh</a></li>
						</ul>
					</div>
				</div>
			</div>
			<div class="col-md-5">
				<div class="card">
					<div class="card-body">
						<div class="progress-card">
							<div class="d-flex justify-content-between mb-1">
								<span class="text-muted">Anntall Kategori</span>
								<span class="text-muted fw-bold" id="categoryCount"> </span>
							</div>
							<div class="progress mb-2" style="height: 7px;">
								<div class="progress-bar bg-info" role="progressbar" id="progressBarCategory" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" data-toggle="tooltip" data-placement="top"></div>
							</div>
						</div>
						<div class="progress-card">
							<div class="d-flex justify-content-between mb-1">
								<span class="text-muted">Anntall Produkt</span>
								<span class="text-muted fw-bold" id="productcount"> </span>
							</div>
							<div class="progress mb-2" style="height: 7px;">
								<div class="progress-bar bg-danger" id="progressBarProduct" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" data-toggle="tooltip" data-placement="top"></div>
							</div>
						</div>
						<div class="progress-card">
							<div class="d-flex justify-content-between mb-1">
								<span class="text-muted">Anntall Aktive Bord</span>
								<span class="text-muted fw-bold" id="totalActiveTableCount"> </span>
							</div>
							<div class="progress mb-2" style="height: 7px;">
								<div class="progress-bar bg-warning" id="progressBarActiveTableCount" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" data-toggle="tooltip" data-placement="top"></div>
							</div>
						</div>
						<div class="progress-card">
							<div class="d-flex justify-content-between mb-1">
								<span class="text-muted">Total Kontantinntekt</span>
								<span class="text-muted fw-bold" id="TotalCashRevenue"> </span>
							</div>
							<div class="progress mb-2" style="height: 7px;">
								<div class="progress-bar bg-success" id="progressBarCashRevenue" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" data-toggle="tooltip" data-placement="top"></div>
							</div>
						</div>
						<div class="progress-card">
                        <div class="d-flex justify-content-between mb-1">
                        <span class="text-muted">Gjennomsnitt Produkt Prise</span>
                        <span class="text-muted fw-bold" id="AveragePrice"> </span>
                        </div>
                        <div class="progress mb-2" style="height: 7px;">
                        <div class="progress-bar bg-black" id="progressBarAveragePrice" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" data-toggle="tooltip" data-placement="top"></div>
                        </div>
                        </div>
					</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="card card-stats">
					<div class="card-body">
						<p class="fw-bold mt-1">Statistic</p>
						<div class="row">
							<div class="col-5">
								<div class="icon-big text-center icon-warning">
									<i class="la la-pie-chart text-warning"></i>
								</div>
							</div>
							<div class="col-7 d-flex align-items-center">
								<div class="numbers">
									<p class="card-category">Aktive Bestillinger</p>
									<h4 class="card-title" id="activeBookingCount"></h4>
								</div>
							</div>
						</div>
						<hr/>
						<div class="row">
							<div class="col-5">
								<div class="icon-big text-center">
									<i class="la la-heart-o text-primary"></i>
								</div>
							</div>
							<div class="col-7 d-flex align-items-center">
								<div class="numbers">
									<p class="card-category">Totalt Tilgjengelige Bord</p>
									<h4 class="card-title" id="totalPassiveTableCount"></h4>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</div>
